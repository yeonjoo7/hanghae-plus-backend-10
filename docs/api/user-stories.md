# 이커머스 시스템 사용자 스토리

## 목차
1. [상품 관리](#1-상품-관리)
2. [장바구니](#2-장바구니)
3. [주문 및 결제](#3-주문-및-결제)
4. [쿠폰 시스템](#4-쿠폰-시스템)
5. [잔액 관리](#5-잔액-관리)
6. [관리자 기능](#6-관리자-기능)

---

## 1. 상품 관리

### US-PROD-001: 상품 정보 조회
**As a** 고객
**I want** 상품의 상세 정보를 조회하고
**So that** 구매하고자 하는 상품의 가격, 설명, 재고를 확인할 수 있다

#### Acceptance Criteria
- [ ] 상품 ID로 상품의 기본 정보(이름, 설명, 가격)를 조회할 수 있다
- [ ] 상품의 현재 재고 수량을 실시간으로 확인할 수 있다
- [ ] 재고가 0인 경우 "품절" 상태로 표시된다
- [ ] 존재하지 않는 상품 ID인 경우 적절한 오류 메시지를 반환한다

#### 관련 요구사항
- REQ-PROD-001, REQ-PROD-002, REQ-PROD-004

---

### US-PROD-002: 여러 상품 조회
**As a** 고객
**I want** 여러 상품을 한 번에 조회하고
**So that** 다양한 상품을 빠르게 비교하고 선택할 수 있다

#### Acceptance Criteria
- [ ] 여러 상품 ID를 입력하여 한 번에 조회할 수 있다
- [ ] 각 상품의 가격, 재고 정보가 포함된다
- [ ] 존재하지 않는 상품은 결과에서 제외되거나 별도로 표시된다
- [ ] 조회 결과는 100ms 이내에 반환된다

#### 관련 요구사항
- REQ-PROD-003, NFR-PERF-001

---

### US-PROD-003: 인기 상품 조회
**As a** 고객
**I want** 최근 인기 있는 상품 목록을 보고
**So that** 트렌드에 맞는 상품을 쉽게 발견할 수 있다

#### Acceptance Criteria
- [ ] 최근 3일간 판매량 기준 상위 5개 상품이 표시된다
- [ ] 각 상품의 판매량 정보가 함께 제공된다
- [ ] 인기 상품 목록은 일정 주기로 자동 갱신된다
- [ ] 품절된 상품도 인기 상품 목록에 포함될 수 있다

#### 관련 요구사항
- REQ-PROD-009, REQ-PROD-010, REQ-PROD-011

---

## 2. 장바구니

### US-CART-001: 장바구니에 상품 추가
**As a** 고객
**I want** 원하는 상품을 장바구니에 담고
**So that** 나중에 한 번에 주문할 수 있다

#### Acceptance Criteria
- [ ] 상품 ID와 수량을 지정하여 장바구니에 추가할 수 있다
- [ ] 장바구니 추가 시 해당 상품의 재고가 충분한지 확인된다
- [ ] 상품에 제한 수량이 있는 경우, 제한 수량을 초과하여 담을 수 없다
- [ ] 이미 장바구니에 있는 상품을 추가하면 수량이 증가한다
- [ ] 재고가 부족한 경우 명확한 오류 메시지를 반환한다

#### 관련 요구사항
- REQ-ORDER-001, REQ-ORDER-004, REQ-ORDER-006

---

### US-CART-002: 장바구니 수량 변경
**As a** 고객
**I want** 장바구니에 담긴 상품의 수량을 조정하고
**So that** 구매하려는 수량을 정확히 설정할 수 있다

#### Acceptance Criteria
- [ ] 장바구니 아이템의 수량을 증가시킬 수 있다
- [ ] 장바구니 아이템의 수량을 감소시킬 수 있다
- [ ] 수량 변경 시 재고를 확인한다
- [ ] 상품 제한 수량을 초과할 수 없다
- [ ] 수량을 0으로 변경하면 장바구니에서 제거된다

#### 관련 요구사항
- REQ-ORDER-002, REQ-ORDER-006

---

### US-CART-003: 장바구니에서 상품 삭제
**As a** 고객
**I want** 장바구니에서 원하지 않는 상품을 제거하고
**So that** 구매하고 싶은 상품만 남길 수 있다

#### Acceptance Criteria
- [ ] 장바구니 아이템을 개별적으로 삭제할 수 있다
- [ ] 삭제 후 장바구니 총 금액이 재계산된다
- [ ] 존재하지 않는 아이템 삭제 시 적절한 오류를 반환한다
- [ ] 삭제는 즉시 반영된다

#### 관련 요구사항
- REQ-ORDER-003

---

### US-CART-004: 장바구니 조회
**As a** 고객
**I want** 내 장바구니에 담긴 상품들을 확인하고
**So that** 주문 전에 구매 내역을 점검할 수 있다

#### Acceptance Criteria
- [ ] 장바구니에 담긴 모든 상품을 조회할 수 있다
- [ ] 각 상품의 이름, 가격, 수량, 소계가 표시된다
- [ ] 장바구니 전체 금액이 계산되어 표시된다
- [ ] 다른 고객의 장바구니는 조회할 수 없다
- [ ] 조회는 50ms 이내에 완료된다

#### 관련 요구사항
- REQ-ORDER-005, NFR-PERF-003

---

## 3. 주문 및 결제

### US-ORDER-001: 주문 생성
**As a** 고객
**I want** 장바구니의 상품들로 주문을 생성하고
**So that** 상품을 구매할 수 있다

#### Acceptance Criteria
- [ ] 장바구니의 모든 상품에 대해 주문이 생성된다
- [ ] 주문 생성 시 모든 상품의 재고가 검증된다
- [ ] 재고가 부족한 상품이 하나라도 있으면 주문이 거부된다
- [ ] 주문 번호가 생성되어 반환된다
- [ ] 주문 정보에는 상품 목록, 수량, 가격이 포함된다

#### 관련 요구사항
- REQ-ORDER-007, REQ-ORDER-009, REQ-ORDER-011

---

### US-ORDER-002: 주문 결제
**As a** 고객
**I want** 생성한 주문에 대해 결제하고
**So that** 상품 구매를 완료할 수 있다

#### Acceptance Criteria
- [ ] 잔액 기반으로 결제가 처리된다
- [ ] 결제 금액은 (상품 총액 - 쿠폰 할인)으로 계산된다
- [ ] 잔액이 부족하면 결제가 거부되고 명확한 메시지를 반환한다
- [ ] 결제 성공 시 잔액이 차감된다
- [ ] 결제 성공 시 재고가 차감된다
- [ ] 결제와 재고 차감은 트랜잭션으로 보장된다
- [ ] 결제 실패 시 재고가 복구된다
- [ ] 결제 처리는 500ms 이내에 완료된다

#### 관련 요구사항
- REQ-PAY-001, REQ-PAY-002, REQ-PAY-003, REQ-PAY-005, REQ-PAY-006
- REQ-ORDER-008, NFR-PERF-002, NFR-REL-002

---

### US-ORDER-003: 쿠폰 적용 결제
**As a** 고객
**I want** 결제 시 쿠폰을 적용하고
**So that** 할인된 가격으로 상품을 구매할 수 있다

#### Acceptance Criteria
- [ ] 보유한 쿠폰을 결제 시 사용할 수 있다
- [ ] cart 타입 쿠폰은 최대 2개까지 사용 가능하다
- [ ] cart_item 타입 쿠폰은 각 상품별로 최대 1개까지 사용 가능하다
- [ ] 쿠폰 할인이 적용된 최종 금액이 계산된다
- [ ] 사용된 쿠폰은 재사용할 수 없다
- [ ] 쿠폰 유효성이 검증된다 (만료일, 소유자, 사용 여부, 적용 대상)

#### 관련 요구사항
- REQ-PAY-004, REQ-PAY-005, REQ-COUPON-007~015

---

### US-ORDER-004: 주문 내역 조회
**As a** 고객
**I want** 내 주문 내역을 확인하고
**So that** 구매한 상품과 결제 정보를 확인할 수 있다

#### Acceptance Criteria
- [ ] 본인의 모든 주문 내역을 조회할 수 있다
- [ ] 주문 번호, 주문 일시, 상품 목록, 결제 금액이 표시된다
- [ ] 사용한 쿠폰 정보가 포함된다
- [ ] 주문 상태(완료, 취소 등)가 표시된다
- [ ] 다른 고객의 주문 내역은 조회할 수 없다

#### 관련 요구사항
- REQ-ORDER-011

---

## 4. 쿠폰 시스템

### US-COUPON-001: 선착순 쿠폰 발급
**As a** 고객
**I want** 선착순으로 제공되는 쿠폰을 발급받고
**So that** 할인 혜택을 받을 수 있다

#### Acceptance Criteria
- [ ] 쿠폰 발급 버튼을 클릭하여 쿠폰을 받을 수 있다
- [ ] 한정 수량이 있는 쿠폰은 수량이 소진되면 발급할 수 없다
- [ ] 같은 쿠폰을 중복으로 발급받을 수 없다
- [ ] 동시에 여러 고객이 요청해도 정확한 수량만 발급된다
- [ ] 발급 성공 시 쿠폰 정보가 반환된다
- [ ] 발급 실패 시 사유(수량 소진, 중복 발급 등)가 명확히 전달된다

#### 관련 요구사항
- REQ-COUPON-001, REQ-COUPON-002, REQ-COUPON-003, REQ-COUPON-004
- NFR-CONC-002, NFR-REL-004

---

### US-COUPON-002: 보유 쿠폰 조회
**As a** 고객
**I want** 내가 보유한 쿠폰 목록을 확인하고
**So that** 사용 가능한 쿠폰을 파악할 수 있다

#### Acceptance Criteria
- [ ] 발급받은 모든 쿠폰을 조회할 수 있다
- [ ] 각 쿠폰의 타입(cart, cart_item), 할인 금액/율이 표시된다
- [ ] 쿠폰의 유효기간이 표시된다
- [ ] 사용 완료된 쿠폰과 미사용 쿠폰이 구분된다
- [ ] 만료된 쿠폰도 조회되지만 별도 표시된다

#### 관련 요구사항
- REQ-COUPON-005, REQ-COUPON-006

---

### US-COUPON-003: 쿠폰 사용 이력 조회
**As a** 고객
**I want** 내가 사용한 쿠폰 내역을 확인하고
**So that** 어떤 주문에 쿠폰을 사용했는지 알 수 있다

#### Acceptance Criteria
- [ ] 사용한 쿠폰의 전체 이력을 조회할 수 있다
- [ ] 각 쿠폰의 사용 일시와 주문 번호가 표시된다
- [ ] 할인받은 금액이 표시된다
- [ ] 사용 이력은 영구 보관되어 언제든지 조회 가능하다

#### 관련 요구사항
- REQ-COUPON-017, REQ-COUPON-018, CONST-DATA-002

---

### US-COUPON-004: 쿠폰 타입별 적용
**As a** 고객
**I want** 쿠폰 타입에 맞게 할인이 적용되고
**So that** 의도한 대로 할인 혜택을 받을 수 있다

#### Acceptance Criteria
- [ ] cart 타입 쿠폰은 장바구니 전체 금액에 적용된다
- [ ] cart_item 타입 쿠폰은 지정된 상품에만 적용된다
- [ ] cart_item 쿠폰은 해당 상품이 장바구니에 있을 때만 사용 가능하다
- [ ] 쿠폰 타입과 적용 대상이 불일치하면 사용이 거부된다
- [ ] 여러 쿠폰 사용 시 할인이 올바르게 계산된다

#### 관련 요구사항
- REQ-COUPON-012, REQ-COUPON-013, REQ-COUPON-014

---

## 5. 잔액 관리

### US-BALANCE-001: 잔액 충전
**As a** 고객
**I want** 내 계정에 잔액을 충전하고
**So that** 상품을 구매할 수 있다

#### Acceptance Criteria
- [ ] 원하는 금액을 입력하여 잔액을 충전할 수 있다
- [ ] 충전 후 잔액이 즉시 반영된다
- [ ] 충전 내역이 기록된다
- [ ] 최소 충전 금액은 1,000원이다
- [ ] 충전 금액은 양수여야 한다

#### 관련 요구사항
- REQ-PAY-007

---

### US-BALANCE-002: 잔액 조회
**As a** 고객
**I want** 내 현재 잔액을 확인하고
**So that** 구매 가능 여부를 판단할 수 있다

#### Acceptance Criteria
- [ ] 현재 보유한 잔액을 조회할 수 있다
- [ ] 잔액 정보는 실시간으로 업데이트된다
- [ ] 다른 고객의 잔액은 조회할 수 없다
- [ ] 잔액 정보는 암호화되어 저장된다

#### 관련 요구사항
- REQ-PAY-001, NFR-SEC-002

---

## 6. 관리자 기능

### US-ADMIN-001: 상품 등록
**As a** 관리자
**I want** 새로운 상품을 등록하고
**So that** 고객이 구매할 수 있도록 한다

#### Acceptance Criteria
- [ ] 상품 이름, 설명, 가격, 초기 재고를 입력하여 등록할 수 있다
- [ ] 상품 제한 수량을 설정할 수 있다 (선택 사항)
- [ ] 등록된 상품은 즉시 고객에게 노출된다
- [ ] 필수 정보가 누락되면 등록이 거부된다
- [ ] 가격과 재고는 0 이상이어야 한다

#### 관련 요구사항
- REQ-PROD-001, CONST-BIZ-004

---

### US-ADMIN-002: 재고 조정
**As a** 관리자
**I want** 상품의 재고를 수동으로 조정하고
**So that** 재고를 정확하게 관리할 수 있다

#### Acceptance Criteria
- [ ] 특정 상품의 재고 수량을 증가시킬 수 있다
- [ ] 특정 상품의 재고 수량을 감소시킬 수 있다
- [ ] 재고는 음수가 될 수 없다
- [ ] 재고 조정 내역이 기록된다
- [ ] 조정 사유를 입력할 수 있다

#### 관련 요구사항
- REQ-PROD-008, CONST-BIZ-004, NFR-REL-001

---

### US-ADMIN-003: 쿠폰 생성
**As a** 관리자
**I want** 새로운 쿠폰을 생성하고
**So that** 고객에게 프로모션 혜택을 제공할 수 있다

#### Acceptance Criteria
- [ ] 쿠폰 이름, 타입(cart/cart_item), 할인 금액/율을 설정할 수 있다
- [ ] 발급 가능한 최대 수량을 설정할 수 있다
- [ ] 쿠폰 유효기간을 설정할 수 있다
- [ ] 최소 주문 금액 조건을 설정할 수 있다 (선택 사항)
- [ ] cart_item 타입 쿠폰은 적용 대상 상품을 지정해야 한다
- [ ] 생성된 쿠폰은 즉시 발급 가능 상태가 된다

#### 관련 요구사항
- REQ-COUPON-001, REQ-COUPON-006, REQ-COUPON-011, REQ-COUPON-012

---

### US-ADMIN-004: 주문 내역 관리
**As a** 관리자
**I want** 모든 주문 내역을 조회하고
**So that** 판매 현황을 파악할 수 있다

#### Acceptance Criteria
- [ ] 전체 주문 내역을 조회할 수 있다
- [ ] 기간별로 필터링할 수 있다
- [ ] 고객별로 필터링할 수 있다
- [ ] 각 주문의 상세 정보를 확인할 수 있다
- [ ] 주문 통계(총 주문 수, 총 매출액)를 확인할 수 있다

#### 관련 요구사항
- REQ-ORDER-011

---

### US-ADMIN-005: 쿠폰 사용 통계 조회
**As a** 관리자
**I want** 쿠폰별 사용 통계를 확인하고
**So that** 프로모션 효과를 분석할 수 있다

#### Acceptance Criteria
- [ ] 각 쿠폰의 발급 수, 사용 수를 확인할 수 있다
- [ ] 쿠폰으로 할인된 총 금액을 확인할 수 있다
- [ ] 기간별 통계를 조회할 수 있다
- [ ] 사용률이 낮은 쿠폰을 식별할 수 있다
- [ ] 통계는 실시간으로 업데이트된다

#### 관련 요구사항
- REQ-COUPON-019

---

### US-ADMIN-006: 인기 상품 통계 조회
**As a** 관리자
**I want** 인기 상품 순위를 확인하고
**So that** 재고 및 마케팅 전략을 수립할 수 있다

#### Acceptance Criteria
- [ ] 최근 3일간 판매량 상위 5개 상품을 확인할 수 있다
- [ ] 각 상품의 판매량과 매출액이 표시된다
- [ ] 통계는 일정 주기로 자동 갱신된다
- [ ] 기간을 변경하여 조회할 수 있다
- [ ] CSV로 다운로드할 수 있다

#### 관련 요구사항
- REQ-PROD-009, REQ-PROD-010, REQ-PROD-011

---

## 7. 시스템 동작

### US-SYSTEM-001: 외부 데이터 전송
**As a** 시스템
**I want** 주문 데이터를 외부 시스템으로 전송하고
**So that** 연동된 시스템과 데이터를 동기화할 수 있다

#### Acceptance Criteria
- [ ] 주문 완료 시 주문 데이터가 자동으로 외부 시스템으로 전송된다
- [ ] 전송은 비동기로 처리된다
- [ ] 전송 실패 시에도 주문은 정상 처리된다
- [ ] 전송 실패 시 실패 내역이 기록된다
- [ ] 실패한 데이터는 자동으로 재전송된다
- [ ] 재전송은 최대 3회까지 시도된다

#### 관련 요구사항
- REQ-INTEGRATION-001~005, NFR-AVAIL-002

---

### US-SYSTEM-002: 동시성 제어
**As a** 시스템
**I want** 동시 주문 시 재고를 정확하게 관리하고
**So that** 재고 부족 또는 과다 차감이 발생하지 않도록 한다

#### Acceptance Criteria
- [ ] 여러 고객이 동시에 같은 상품을 주문해도 재고가 정확히 차감된다
- [ ] 재고 이상으로 주문이 확정되지 않는다
- [ ] 락(Lock) 메커니즘을 통해 동시성을 제어한다
- [ ] 동시성 제어로 인한 대기 시간은 최소화된다
- [ ] 데드락이 발생하지 않는다

#### 관련 요구사항
- NFR-CONC-001, NFR-CONC-003, NFR-REL-001

---

## 스토리 맵

### Epic 1: 상품 관리
- US-PROD-001: 상품 정보 조회
- US-PROD-002: 여러 상품 조회
- US-PROD-003: 인기 상품 조회
- US-ADMIN-001: 상품 등록
- US-ADMIN-002: 재고 조정

### Epic 2: 장바구니 & 주문
- US-CART-001: 장바구니에 상품 추가
- US-CART-002: 장바구니 수량 변경
- US-CART-003: 장바구니에서 상품 삭제
- US-CART-004: 장바구니 조회
- US-ORDER-001: 주문 생성
- US-ORDER-002: 주문 결제
- US-ORDER-003: 쿠폰 적용 결제
- US-ORDER-004: 주문 내역 조회

### Epic 3: 쿠폰 시스템
- US-COUPON-001: 선착순 쿠폰 발급
- US-COUPON-002: 보유 쿠폰 조회
- US-COUPON-003: 쿠폰 사용 이력 조회
- US-COUPON-004: 쿠폰 타입별 적용
- US-ADMIN-003: 쿠폰 생성
- US-ADMIN-005: 쿠폰 사용 통계 조회

### Epic 4: 잔액 관리
- US-BALANCE-001: 잔액 충전
- US-BALANCE-002: 잔액 조회

### Epic 5: 관리 & 통계
- US-ADMIN-004: 주문 내역 관리
- US-ADMIN-006: 인기 상품 통계 조회

### Epic 6: 시스템 안정성
- US-SYSTEM-001: 외부 데이터 전송
- US-SYSTEM-002: 동시성 제어

---

## 우선순위별 분류

### Must Have (P0)
- US-PROD-001, US-PROD-002
- US-CART-001, US-CART-002, US-CART-003, US-CART-004
- US-ORDER-001, US-ORDER-002
- US-BALANCE-001, US-BALANCE-002
- US-ADMIN-001, US-ADMIN-002
- US-SYSTEM-002

### Should Have (P1)
- US-PROD-003
- US-ORDER-003, US-ORDER-004
- US-COUPON-001, US-COUPON-002, US-COUPON-004
- US-ADMIN-003, US-ADMIN-004
- US-SYSTEM-001

### Could Have (P2)
- US-COUPON-003
- US-ADMIN-005, US-ADMIN-006

---

## 문서 이력

| 버전 | 날짜 | 작성자 | 변경 내역 |
|------|------|--------|-----------|
| 1.0 | 2025-10-31 | System | 초기 사용자 스토리 작성 |
