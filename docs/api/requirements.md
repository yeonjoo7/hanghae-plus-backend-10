# 이커머스 시스템 요구사항 명세서

## 목차
1. [개요](#개요)
2. [사용자 역할 및 권한](#사용자-역할-및-권한)
3. [기능적 요구사항](#기능적-요구사항)
4. [비기능적 요구사항](#비기능적-요구사항)
5. [제약사항](#제약사항)

---

## 개요

본 문서는 이커머스 시스템의 핵심 기능에 대한 요구사항을 정의합니다. 시스템은 상품 관리, 주문/결제, 쿠폰 관리, 외부 데이터 연동 기능을 제공합니다.

---

## 사용자 역할 및 권한

### 1. 고객 (Customer)
- 상품 조회 및 검색
- 인기 상품 조회
- 장바구니 관리 (추가, 삭제, 수정)
- 주문 및 결제
- 쿠폰 발급 및 사용
- 잔액 조회 및 충전
- 주문 내역 조회

### 2. 관리자 (Admin)
- 상품 등록, 수정, 삭제
- 재고 관리
- 쿠폰 생성 및 관리
- 주문 내역 조회 및 관리
- 통계 조회
- 시스템 설정 관리

### 3. 시스템 (System)
- 재고 자동 차감
- 쿠폰 유효성 자동 검증
- 주문 데이터 외부 전송
- 인기 상품 통계 자동 집계

---

## 기능적 요구사항

### 1. 상품 관리

#### 1.1 상품 정보 조회
- **REQ-PROD-001**: 시스템은 상품의 기본 정보(ID, 이름, 설명, 가격)를 조회할 수 있어야 한다.
- **REQ-PROD-002**: 시스템은 상품의 현재 재고 수량을 실시간으로 조회할 수 있어야 한다.
- **REQ-PROD-003**: 시스템은 여러 상품을 한 번에 조회할 수 있어야 한다.
- **REQ-PROD-004**: 시스템은 재고가 없는 상품에 대해 품절 상태를 표시해야 한다.

#### 1.2 재고 관리
- **REQ-PROD-005**: 시스템은 상품의 재고 수량을 실시간으로 확인할 수 있어야 한다.
- **REQ-PROD-006**: 시스템은 주문 시 재고를 자동으로 차감해야 한다.
- **REQ-PROD-007**: 시스템은 재고 부족 시 주문을 거부해야 한다.
- **REQ-PROD-008**: 관리자는 재고를 수동으로 조정할 수 있어야 한다.

#### 1.3 인기 상품 통계
- **REQ-PROD-009**: 시스템은 최근 3일간의 판매 데이터를 기반으로 인기 상품을 집계해야 한다.
- **REQ-PROD-010**: 시스템은 판매량 상위 5개 상품을 인기 상품으로 제공해야 한다.
- **REQ-PROD-011**: 인기 상품 통계는 일정 주기로 자동 갱신되어야 한다.

### 2. 주문/결제 시스템

#### 2.1 장바구니 기능
- **REQ-ORDER-001**: 고객은 상품을 장바구니에 추가할 수 있어야 한다.
- **REQ-ORDER-002**: 고객은 장바구니에 담긴 상품의 수량을 변경할 수 있어야 한다.
- **REQ-ORDER-003**: 고객은 장바구니에서 상품을 삭제할 수 있어야 한다.
- **REQ-ORDER-004**: 시스템은 장바구니 담기 시 상품의 재고를 확인해야 한다.
- **REQ-ORDER-005**: 장바구니는 고객별로 독립적으로 관리되어야 한다.
- **REQ-ORDER-006**: 상품에 제한 수량이 설정된 경우, 한 장바구니에 제한 수량을 초과하는 수량을 담을 수 없어야 한다.

#### 2.2 주문 처리
- **REQ-ORDER-007**: 시스템은 주문 전 모든 상품의 재고를 검증해야 한다.
- **REQ-ORDER-008**: 시스템은 주문 확정 시 재고를 즉시 차감해야 한다.
- **REQ-ORDER-009**: 재고 부족 시 시스템은 명확한 오류 메시지와 함께 주문을 거부해야 한다.
- **REQ-ORDER-010**: 주문 처리는 원자성(Atomicity)을 보장해야 한다.
- **REQ-ORDER-011**: 시스템은 주문 내역을 저장하고 조회할 수 있어야 한다.

#### 2.3 결제 처리
- **REQ-PAY-001**: 시스템은 고객의 잔액을 기반으로 결제를 처리해야 한다.
- **REQ-PAY-002**: 잔액이 부족한 경우 결제를 거부해야 한다.
- **REQ-PAY-003**: 결제 완료 시 고객의 잔액을 차감해야 한다.
- **REQ-PAY-004**: 결제 시 쿠폰 할인이 적용되어야 한다.
- **REQ-PAY-005**: 최종 결제 금액은 (상품 금액 - 쿠폰 할인)으로 계산되어야 한다.
- **REQ-PAY-006**: 결제 실패 시 차감된 재고를 복구해야 한다.
- **REQ-PAY-007**: 고객은 잔액을 충전할 수 있어야 한다.

### 3. 쿠폰 시스템

#### 3.1 쿠폰 발급
- **REQ-COUPON-001**: 시스템은 선착순으로 한정 수량의 쿠폰을 발급해야 한다.
- **REQ-COUPON-002**: 쿠폰 수량이 소진되면 더 이상 발급할 수 없어야 한다.
- **REQ-COUPON-003**: 동일한 고객이 같은 쿠폰을 중복 발급받을 수 없어야 한다.
- **REQ-COUPON-004**: 쿠폰 발급은 동시성 제어를 통해 정확한 수량만 발급되어야 한다.
- **REQ-COUPON-005**: 고객은 발급받은 쿠폰 목록을 조회할 수 있어야 한다.
- **REQ-COUPON-006**: 쿠폰은 적용 대상에 따라 타입(cart, cart_item 등)이 구분되어야 한다.

#### 3.2 쿠폰 유효성 검증
- **REQ-COUPON-007**: 시스템은 쿠폰 사용 전 유효성을 검증해야 한다.
- **REQ-COUPON-008**: 만료된 쿠폰은 사용할 수 없어야 한다.
- **REQ-COUPON-009**: 이미 사용된 쿠폰은 재사용할 수 없어야 한다.
- **REQ-COUPON-010**: 쿠폰 소유자가 아닌 경우 사용할 수 없어야 한다.
- **REQ-COUPON-011**: 최소 주문 금액 조건이 있는 경우 이를 검증해야 한다.
- **REQ-COUPON-012**: 쿠폰 타입에 따라 적용 범위가 달라야 한다.
  - `cart` 타입: 장바구니 전체 금액에 적용
  - `cart_item` 타입: 특정 상품(들)에만 적용
- **REQ-COUPON-013**: 시스템은 쿠폰 타입과 적용 대상의 일치 여부를 검증해야 한다.
- **REQ-COUPON-014**: `cart_item` 타입 쿠폰은 지정된 상품이 장바구니에 포함되어 있을 때만 사용 가능해야 한다.
- **REQ-COUPON-015**: 시스템은 주문 시 쿠폰 사용 개수 제한을 검증해야 한다.
  - `cart` 타입: 주문당 최대 2개까지 사용 가능
  - `cart_item` 타입: 각 상품별로 최대 1개까지 사용 가능

#### 3.3 쿠폰 사용 이력 관리
- **REQ-COUPON-016**: 시스템은 쿠폰 사용 이력을 기록해야 한다.
- **REQ-COUPON-017**: 쿠폰 사용 시 사용 일시와 주문 정보를 함께 저장해야 한다.
- **REQ-COUPON-018**: 고객은 자신의 쿠폰 사용 이력을 조회할 수 있어야 한다.
- **REQ-COUPON-019**: 관리자는 쿠폰별 사용 통계를 조회할 수 있어야 한다.

### 4. 데이터 연동

#### 4.1 외부 시스템 연동
- **REQ-INTEGRATION-001**: 시스템은 주문 완료 시 주문 데이터를 외부 시스템으로 전송해야 한다.
- **REQ-INTEGRATION-002**: 외부 시스템 전송 실패 시에도 주문은 정상적으로 처리되어야 한다.
- **REQ-INTEGRATION-003**: 전송 실패한 데이터는 별도로 기록하여 재전송할 수 있어야 한다.
- **REQ-INTEGRATION-004**: 외부 전송은 비동기로 처리되어야 한다.
- **REQ-INTEGRATION-005**: 전송 실패 시 재시도 로직이 구현되어야 한다.

---

## 비기능적 요구사항

### 1. 성능 (Performance)

#### 1.1 응답 시간
- **NFR-PERF-001**: 상품 조회 API는 평균 100ms 이내에 응답해야 한다.
- **NFR-PERF-002**: 주문 처리는 평균 500ms 이내에 완료되어야 한다.
- **NFR-PERF-003**: 장바구니 조회는 평균 50ms 이내에 응답해야 한다.

#### 1.2 처리량
- **NFR-PERF-004**: 시스템은 초당 최소 100건의 주문을 처리할 수 있어야 한다.
- **NFR-PERF-005**: 쿠폰 발급 시 동시 요청을 안정적으로 처리할 수 있어야 한다.

### 2. 가용성 (Availability)

- **NFR-AVAIL-001**: 시스템은 연간 99.9% 이상의 가용성을 보장해야 한다.
- **NFR-AVAIL-002**: 외부 시스템 장애가 주문 처리에 영향을 주어서는 안 된다.
- **NFR-AVAIL-003**: 데이터베이스 장애 대비 복구 계획이 수립되어야 한다.

### 3. 확장성 (Scalability)

- **NFR-SCALE-001**: 시스템은 수평 확장이 가능한 구조여야 한다.
- **NFR-SCALE-002**: 트래픽 증가 시 자동 스케일링을 지원해야 한다.
- **NFR-SCALE-003**: 상품 수가 증가해도 성능 저하가 최소화되어야 한다.

### 4. 보안 (Security)

- **NFR-SEC-001**: 모든 API는 인증을 거쳐야 한다.
- **NFR-SEC-002**: 고객의 잔액 정보는 암호화되어 저장되어야 한다.
- **NFR-SEC-003**: 결제 정보는 PCI-DSS 기준을 준수해야 한다.
- **NFR-SEC-004**: SQL Injection, XSS 등 보안 취약점에 대한 방어가 구현되어야 한다.

### 5. 신뢰성 (Reliability)

- **NFR-REL-001**: 재고 차감은 정확해야 하며, 과다 차감이 발생해서는 안 된다.
- **NFR-REL-002**: 결제와 재고 차감은 트랜잭션으로 보장되어야 한다.
- **NFR-REL-003**: 시스템 장애 시 데이터 무결성이 유지되어야 한다.
- **NFR-REL-004**: 쿠폰 발급 수량은 설정된 한도를 초과할 수 없다.

### 6. 동시성 제어 (Concurrency)

- **NFR-CONC-001**: 동시에 같은 상품을 주문하는 경우 재고 차감이 정확해야 한다.
- **NFR-CONC-002**: 쿠폰 선착순 발급 시 Race Condition이 발생하지 않아야 한다.
- **NFR-CONC-003**: 낙관적 락 또는 비관적 락을 통해 동시성을 제어해야 한다.

### 7. 유지보수성 (Maintainability)

- **NFR-MAINT-001**: 코드는 명확한 아키텍처 패턴을 따라야 한다.
- **NFR-MAINT-002**: API 문서(Swagger/OpenAPI)가 자동 생성되어야 한다.
- **NFR-MAINT-003**: 주요 비즈니스 로직은 단위 테스트가 작성되어야 한다.
- **NFR-MAINT-004**: 로깅은 체계적으로 구현되어야 한다.

### 8. 모니터링 (Monitoring)

- **NFR-MONITOR-001**: 시스템 상태를 실시간으로 모니터링할 수 있어야 한다.
- **NFR-MONITOR-002**: 에러 발생 시 알림이 전송되어야 한다.
- **NFR-MONITOR-003**: API 응답 시간과 성공률을 추적해야 한다.
- **NFR-MONITOR-004**: 재고 수준에 대한 알림 기능이 있어야 한다.

---

## 제약사항

### 1. 기술 제약사항

- **CONST-TECH-001**: 백엔드는 Java/Spring Boot 기반으로 개발되어야 한다.
- **CONST-TECH-002**: 데이터베이스는 관계형 데이터베이스(MySQL)를 사용해야 한다.
- **CONST-TECH-003**: RESTful API 설계 원칙을 따라야 한다.

### 2. 비즈니스 제약사항

- **CONST-BIZ-001**: 인기 상품 통계는 최근 3일 데이터로 제한된다.
- **CONST-BIZ-002**: 인기 상품은 상위 5개로 제한된다.
- **CONST-BIZ-003**: 쿠폰은 주문 1건당 다음과 같이 제한된다.
  - 장바구니 전체 쿠폰(cart): 최대 2개까지 사용 가능
  - 특정 상품 쿠폰(cart_item): 각 상품별로 최대 1개까지 사용 가능
- **CONST-BIZ-004**: 재고는 음수가 될 수 없다.
- **CONST-BIZ-005**: 쿠폰 타입은 cart(장바구니 전체), cart_item(특정 상품) 등으로 구분된다.

### 3. 데이터 제약사항

- **CONST-DATA-001**: 주문 데이터는 최소 3년간 보관되어야 한다.
- **CONST-DATA-002**: 쿠폰 사용 이력은 영구 보관되어야 한다.
- **CONST-DATA-003**: 개인정보는 관련 법규에 따라 관리되어야 한다.

---

## 우선순위

### High Priority
- 상품 조회 및 재고 관리
- 주문/결제 처리
- 재고 동시성 제어
- 데이터 무결성 보장

### Medium Priority
- 쿠폰 시스템
- 인기 상품 통계
- 외부 시스템 연동

### Low Priority
- 고급 검색 기능
- 추천 시스템
- 상세 통계 리포트

---

## 향후 고려사항

1. **장바구니 만료 정책**: 일정 시간 후 장바구니 자동 정리
2. **위시리스트 기능**: 관심 상품 저장
3. **리뷰 시스템**: 상품 리뷰 및 평점
4. **알림 기능**: 재입고 알림, 주문 상태 알림
5. **추천 시스템**: 개인화된 상품 추천
6. **포인트 시스템**: 구매 시 포인트 적립
7. **배송 추적**: 주문 배송 상태 추적
8. **반품/환불**: 주문 취소 및 환불 처리

---

## 문서 이력

| 버전 | 날짜 | 작성자 | 변경 내역 |
|------|------|--------|-----------|
| 1.0 | 2025-10-31 | System | 초기 요구사항 명세서 작성 |
| 1.1 | 2025-10-31 | System | 쿠폰 타입별 적용 범위 요구사항 추가 (REQ-COUPON-006, 012-014) |
| 1.2 | 2025-10-31 | System | 장바구니 상품 제한 수량 요구사항 추가 (REQ-ORDER-006)<br>쿠폰 사용 개수 제한 요구사항 추가 및 수정 (REQ-COUPON-015, CONST-BIZ-003) |
